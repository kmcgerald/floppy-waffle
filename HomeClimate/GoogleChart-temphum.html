<!-- I based this page on the example from SparkFun's Phant.IO project example found here http://phant.io/graphing/google/2014/07/07/graphing-data/
  This one is meant to handle generating a separate line for each sensor reading coming from different locations/nodes.
  
  To start off I built two sensor nodes which each had a temperature and humidity sensor on board. One node was in my bedroom
  and the other was in my garage.  Every 60 seconds each node will connect to my WiFi and upload a reading to data.sparkfun.com via HTTP
  such that every record has a Temp F, Temp C, Humidity, Location and a timestamp generated by the Sparkfun server. The two sensor 
  nodes don't know anything about one another's existance so there is no coordination of upload times.

  This page will use JQuery to request the data from data.sparkfun.com in JSONP format. I wanted to have a line for each combination of location
  and sensor reading so to make Google Charts happy, I loop over each row of data from and build a new row in the DataTable which has the
  timestamp and a column for each location-sensor combination. So for the example build mentioned above, I have Bedroom Temp, Bedroom Humidity, 
  Garage Temp, and Garage Humidity. Since I only have 2 of the values for one location in each source row, I simply Null the values for the other
  two columns.  I know it's a bit of a hack but I couldn't get Google Charts to split it out any other way even by trying to label the Location 
  field as an extra domain.  The code has comments inline explaining stuff that might not be immediately obvious. 
-->
<!DOCTYPE html>
<html>
  <head>
    <!-- EXTERNAL LIBS-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://www.google.com/jsapi"></script>

    <!-- EXAMPLE SCRIPT -->
    <script>

      // onload callback
      function drawChart() {

        var public_key = 'yourPublicKeyGoesHere';

        // JSONP request
        var jsonData = $.ajax({
          url: 'https://data.sparkfun.com/output/' + public_key + '.json',
          data: {
            'gte': {
             'timestamp': 'now - 48 hours'}
	  },
          dataType: 'jsonp',
        }).done(function (results) {

          var data = new google.visualization.DataTable();

          data.addColumn('datetime', 'Time');
          data.addColumn('number', 'Bedroom Temp');
          data.addColumn('number', 'Garage Temp');
          data.addColumn('number', 'Bedroom Humidity');
          data.addColumn('number', 'Garage Humidity');


          // Loop over the data returned in the JSON, check the location and put the Temp and Humidity in the right columns
          $.each(results, function (i, row) {
            if (String(row.location) == "Garage") {
              data.addRow([
                (new Date(row.timestamp)),
                null, // We don't have MB Temp
                parseFloat(row.tempf),
                null, // We don't have MB Humidity
                parseFloat(row.humidity)
              ]);
            } else if (String(row.location) == "MasterBedroom") {
              data.addRow([
                (new Date(row.timestamp)),
                parseFloat(row.tempf),
                null, // We don't have Garage Temp
                parseFloat(row.humidity),
                null // We don't have Garage Humidity
              ]);
            }
          }); //end .each loop

          var chart = new google.visualization.LineChart($('#chart').get(0));

          chart.draw(data, {
            title: 'Household Climate',
            interpolateNulls: true   // Fill in the gaps between points caused by null values
          });

        }); // end callback function

      } //end drawChart

      // load chart lib
      google.load('visualization', '1', {
        packages: ['corechart']
      });

      // call drawChart once google charts is loaded
      google.setOnLoadCallback(drawChart);

    </script>

  </head>
  <body>
    <div id="chart" style="width: 100%; height: 500px;"></div>
  </body>
</html>
